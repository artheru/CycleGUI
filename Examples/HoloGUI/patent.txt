权   利   要   求   书
1. 一种光栅标定方法，其特征在于，
。
 
9. 一种光栅显示系统，其特征在于， 

 
说   明   书
一种视角追踪的光栅立体显示系统和标定方法
技术领域
本发明涉及立体显示技术领域，尤其涉及一种视角追踪的光栅立体显示系统和系统标定方法。
背景技术
随着显示技术的不断进步，人们对三维立体显示的需求日益增长。目前，常见的三维显示方式包括双目立体显示（如常见的VR、AR设备）、光栅立体显示等。其中，光栅立体显示屏可对不同的观看角度呈现不同的画面，能够较好满足裸眼3D显示的需求。但传统的光栅立体显示中，对系统计算量的要求极高，需要同时渲染数十甚至上百幅画面，以满足各个视角上均能提供具有立体感的裸眼3D画面。即便如此，该显示方案中，不仅某些观看角度下无法获得最佳显示效果，而且景深受限。
在申请号为201710870112.6的中国专利中，提出一种立体显示方法：获取人眼的眼动信息数据；依据所述眼动信息数据，获取人眼在所述立体显示设备上的注视点的位置信息；通过所述注视点的位置信息确定显示区域；依据所述眼动信息数据以及预设标定文件，计算所述显示区域内液晶光栅的参数；通过所述液晶光栅的参数控制所述显示区域的电压，在所述显示区域显示立体图像。该专利通过人眼动信息数据以及预标定文件计算光栅参数，预设标定文件包括人眼相对于立体显示设备的不同空间位置与液晶光栅的参数对应的关系，及人眼的瞳孔尺寸和瞳孔距离与液晶光栅的参数对应的关系，液晶光栅的参数包括液晶光栅的节距、角度。它需要观看者位于相对于立体显示设备前后、左右、上下的不同空间位置，对液晶光栅的参数进行调节，找出3D效果最佳时的液晶光栅的参数，并进行标定、存储。而且在标定的时候，需要将人眼的瞳孔尺寸和瞳孔距离与预设标定文件中的人眼的瞳孔尺寸和瞳孔距离作比较，将其差值对初始液晶光栅参数进行微调，得到最佳液晶光栅的参数。可以看出其得到光栅参数的方法不仅需要人的参与，而且不同的人由于人眼参数不同，也会得到不同的最佳参数，且方法操作复杂，容易引入人为误差。
这个方案是用人眼注视屏幕的位置来作优化的。和本文没有关系。
有没有计算量很大的论文或专利，用于说明咱们的计算量小的？
本方案需要多少个视角就渲染多少个视角。常规光栅立体显示屏方案需要渲染固定个数的大量视角。
发明内容
为了为提升裸眼3D立体显示的景深、并产生更为流畅的画面，本发明提出一种立体显示系统，通过在光栅立体显示系统中引入眼球位置追踪机制，使系统能够根据用户双眼的实时位置动态渲染显示画面，从而精确控制渲染时使用的视点位置，并减少不必要的视点渲染，降低系统计算量，最终在用户实际观看的视角上获得大景深且精确渲染的立体显示效果。
为了获得准确的光栅参数和眼球位置，本发明提出了一种光栅、屏幕和眼球追踪器的联合标定方法，仅依赖测试相机位置，而无需人员的参与即可获得准确的标定参数。 
根据本发明的一个方面，提出了一种光栅、屏幕和眼球追踪器的联合标定方法，
根据本发明的另一个方面，提出了一种立体显示系统。
本发明提供的光栅标定方法和立体显示系统的有益效果包括：
1. 本发明基于眼球追踪和光栅的立体显示系统，通过结合3D相机对用户眼睛位置的实时追踪，并配合光栅显示器的光学特性，实现对单个或多个观众眼睛的视点自适应立体显示，从而在降低计算复杂度的同时保持良好的立体显示效果。
2.针对每只眼睛实时调整视点图像，保证最佳立体视觉一致性，立体效果更佳。
3.灵活性高：系统可自动适配单人或多人多眼的观看环境，不同观看者或不同观看位置都能获得良好的立体显示效果。
4.观看效果提升：可精确为实际观看视角准确渲染视角所应该看到的画面，避免在固定多视点渲染下出现：由于渲染视点和实际视点有误差造成的模糊现象，或由于实际视点在渲染视点以外造成的3D画面失真问题。
附图说明
附图用来提供对本发明的进一步理解，并且构成说明书的一部分，与本发明的实施例一起用于解释本发明，并不构成对本发明的限制。在附图中：
图1为本发明系统组成示意图；
 
图2为眼睛追踪的立体光栅显示的工作原理图；
 
图3为本发明视角渲染和光栅交织图案过程流程示意图。
 
具体实施方式
在本发明的描述中，需要理解的是，术语“中心”、“纵向”、“横向”、“长度”、“宽度”、“厚度”、“上”、“下”、“前”、“后”、“左”、“右”、“竖直”、“水平”、“顶”、“底”“内”、“外”、“顺时针”、“逆时针”等指示的方位或位置关系为基于附图所示的方位或位置关系，仅是为了便于描述本发明和简化描述，而不是指示或暗示所指的装置或元件必须具有特定的方位、以特定的方位构造和操作，因此不能理解为对本发明的限制。
在本发明中，除非另有明确的规定和限定，术语“安装”、“相连”、“连接”、“固定”等术语应做广义理解，例如，可以是固定连接，也可以是可拆卸连接，或一体地连接；可以是机械连接，也可以是电连接；可以是直接相连，也可以通过中间媒介间接相连，可以是两个元件内部的连通。对于本领域的普通技术人员而言，可以根据具体情况理解上述术语在本发明中的具体含义。
以下结合附图对本发明的优选实施例进行说明，应当理解，此处所描述的优选实施例仅用于说明和解释本发明，并不用于限定本发明。

本发明提出一种立体显示系统，包括：3D相机光栅显示器器件，由光栅膜、显示屏、3D相机组成；眼球位置追踪模块；标定模块；视角渲染和光栅交织图生成模块，共同构成，其中，
3D相机光栅显示器器件，用于获取观看者3D信息，并用于输出立体图像。其显示部分由底层显示屏与覆盖其上的垂直柱状光栅组成。3D相机（如ToF相机或双目深度相机）布置在显示器附近。光栅间距d、光栅与屏幕的夹角θ、光栅相对于屏幕左上角的初始偏移d₀、3D相机相对屏幕位姿矩阵M，是影响成像的重要参数。屏幕分辨率设为w×h、实际物理尺寸为X×Y。
眼球位置追踪模块，用于获取观众眼睛相对于3D相机的实时空间位置坐标（x,y,z）。可根据用户头部姿态变化，实时输出眼睛跟踪信息。能够追踪获取人眼的空间位置与朝向；若多人观看，则分别获取每只眼睛的相应信息。该模块将追踪到的眼睛坐标信息传给后续视角渲染和光栅交织图生成模块，用于计算各个光栅条带在屏幕像素坐标系中的正确映射。
标定模块，用于获取准确的光栅显示参数和3D相机与显示器之间的空间关系，并将结果传送给视角渲染和光栅交织图生成模块，包括光栅参数标定单元和光栅立体显示屏与3D相机相对位姿标定单元。标定模块包括光栅参数标定单元，用于标定光栅的真实物理周期b、光栅相对于底屏左上角的相对几何偏移（即初始偏移d₀），确定光栅显示器本身的光栅参数（间距d、光栅与屏幕夹角θ等），并传送给交织模块，确保渲染与显示的光学模型准确。标定模块还包括光栅立体显示屏与3D相机相对位姿标定单元，用于标定3D相机与显示器之间的空间关系，采用常规方法，如使用棋盘格标定等。
视角渲染和光栅交织图生成模块（后称交织模块），连接3D相机光栅显示器器件和眼球追踪模块，获取眼球追踪模块传送的眼球位置后，调用3D渲染程序（如OpenGL、DirectX等）实时计算并对光栅条带进行逐条映射和像素控制，生成适合该眼睛的光栅立体显示图像：保证每只眼睛看到的像素子图互不干扰，从而在空间上形成立体视觉。最后将结果发送到光栅显示器进行输出。

在交织模块中，针对每只眼睛进行以下操作：
S1、接收眼球位置追踪模块获取的人眼相对于3D显示器的位置，并根据标定模块的光栅立体显示屏与3D相机相对位姿，计算人眼在显示屏的空间位置（x, y, z）；
S2、对每只眼睛进行视点计算和图像渲染，将渲染后的图像合成或叠加，输出到光栅显示器。由于光栅的柱状透镜效应，不同的观察角度只会看到与其视线方向一致的像素子图，从而在用户的眼睛位置形成立体视觉。
在S2中，渲染画面（以使用OpenGL为例）的方法包括：
S211、根据眼睛的空间位置E=（x,y,z），设置虚拟摄像机的位置和视角（投影矩阵与视图矩阵）；
S212、场景渲染：将虚拟3D场景正常渲染到一个离屏帧缓冲（Frame Buffer Object, FBO），即纹理中，得到该眼睛视点下的场景图像；
S213、光栅映射计算，以得到该眼睛视点下合理显示的场景图像，具体包括：
（1）各个光栅条带位置计算：光栅显示器由多个等间距的和垂直方向具有θ夹角光栅条带组成，需要确定每个条带的精确位置，为后续计算每个光栅条带的显示内容做准备。第n条光栅的距离公式如下：
Gₙ = n * d + d₀
其中d为光栅间距，d₀为初始偏移量，n为光栅条带序号。
参数范围：d的取值范围：0.1mm至1.0mm，优选0.3mm至0.5mm，精确值可通过标定获得。d₀的取值范围：0至d，可通过标定获得；n的取值范围：0至⌊X/dcosθ+Y/dsinθ⌋。
第n条光栅的中心点为：
Cₙ = (Gₙcosθ, Gₙsinθ) +ê⊥*补偿项
其中ê⊥=(sinθ,-cosθ)为光栅垂直方向，补偿项用于针对观察角较大的时候做柱镜成像畸变修正。补偿项一般可以是观察角α的一次函数或二次函数。
观察角α的计算方法如下：
1. 将眼睛位置在该光栅条带方向上投影：
   E′= Cₙ + [((x,y) - Cₙ)·ê]·ê
   其中 ê 为光栅方向的单位向量，(x,y) 为眼睛的空间位置中屏幕X和Y方向的分量
2. 计算观察角度：
   α = arccos(n̂·v)
   其中：
   - n̂ = (0, 0, 1) 为显示屏法向量
   - v = normalize(E - E′) 为归一化后的视线向量
（2）可视角度区间计算：每个光栅条带都像一个小柱面镜片，只能在特定角度范围内精确地显示图像。超过角度范围成像质量会下降。计算公式如下：
Δα = 2 * arctan(d / (2h))
其中h为光栅到显示屏的垂直距离。
参数范围：h的取值范围：0.5mm至2.0mm，优选0.8mm至1.2mm；可通过标定精确获得。对于每条光栅都需要α<Δα，超出此范围容易导致左右眼图像发生重影串扰，并需要做去重影处理。
本步骤用于确定每个光栅条带能被观察到的角度范围，避免图像发生重影串扰。
（3）通过各个光栅逆投影视点到屏幕坐标系上。由于光路的可逆性，该步骤可以用于计算出眼睛视点透过光栅所看到的屏幕区域，从而用于后续着色用途。这个屏幕区域是一个狭长的与垂直角度成θ角的长方形，记长方形的中点为P：
P = Cₙ - (x, y) * h/vz。
该长方形长度方向贯穿屏幕，宽度为Δu。取值范围为0.05mm至0.1mm。
（4）交织着色：将3D场景渲染结果中的正确部分映射到光栅条带对应的屏幕区域上。其使用的纹理坐标如下：
u坐标：u = (P.x - x_min) / (x_max - x_min)；
v坐标：v = (P.y - y_min) / (y_max - y_min)；
其中P为视线与显示屏的交点坐标。从S212中纹理以uv坐标取色并填入屏幕区域。若该光栅的视角α>Δα，则需要做去重影方法。去重影方法为：
1. 记当前视角的待输出颜色值为ψ1=（r1,g1,b1）为其红绿蓝值, 当前光栅其它视角的待输出颜色值为ψ2=（r2,g2,b2），则实际对于该光栅当前视角下，实际输出值为
ψ=ψ1+B1-ψ2*B2
其中，B1为最大漏光量，B2为漏光比例。这表示当前光栅因为超出最佳可视角而相互漏光到其它光栅，因而需要进行补偿。
对于多用户观看，只需进一步增加眼睛视点即可使多个用户同时看到3D场景，实际可能因为屏幕分辨率限制导致少量串扰。

实施例2：单人观看场景
1.	硬件配置：
o	显示器：23.8英寸4K分辨率光栅显示屏；
o	光栅参数：d = 0.35mm，h = 1.0mm；
o	3D相机：60fps采样率，±1cm定位精度。
2.	测试结果：
o	最佳观看距离：500mm；
o	视点追踪延迟：≤16.7ms；
o	系统帧率：稳定60fps；
o	立体视差：最大8cm。
实施例3：双人观看场景
1.	硬件配置：同实施例2。
2.	测试场景：
o	两位观众分别位于显示器左右45°位置；
o	观看距离：700mm。
3.	测试结果：
o	每人帧率：稳定30fps；
o	串扰率：≤5%；
o	有效观看范围：±40°。
本发明的立体显示系统，硬件部分仅需要在显示器前端加装光栅（或直接购买带光栅的显示屏）并搭配3D相机即可实现，无需在观众侧加装任何额外设备，部署过程简单灵活。可应用于广告展示、教育培训、医疗可视化、远程交互、游戏娱乐等多种领域，对大屏幕和中小型显示设备均具备良好的兼容性。
借助光栅立体显示技术，本系统可在一定范围内提供多视角近似全息的3D画面。配合眼球追踪后，系统仅对实际观察视点进行渲染，避免重复计算无用视点，大幅降低计算量。本发明可通过3D相机实现对观众双眼位置的实时追踪，根据眼球位置动态更新立体画面，使得观看者在移动或转头时，仍能维持清晰稳定的立体视觉。


本发明还提出了一种光栅标定方法，仅依赖相机位置而非相机姿态与人员参与，它使光栅（周期b）与底屏显示的线条（周期a）平行且在同一平面投影方向上重合，以产生易于分析的莫尔条纹（Moiré）效果，分析该条纹从而解算出光栅参数。
通常，光栅立体显示屏由底层显示屏（简称底屏）与覆盖其上的垂直柱状光栅组成。光栅的真实物理间距d、光栅与屏幕的夹角θ、光栅相对于底屏左上角的相对几何偏移（即初始偏移d₀）和光栅和底屏的距离h是影响成像的重要参数。本发明中对光栅的真实物理周期d、光栅相对于底屏左上角的相对几何偏移（即初始偏移d₀）进行自动标定，标定的具体步骤如下：
S1、在底屏上以随机已知周期aᵢ显示和光栅平行的线条；
S2、在距离Lᵢ处，使用相机拍摄屏幕，获得图像i；
S3、在拍摄图像i中，检测莫尔条纹出现的周期Mᵢ(Lᵢ)；
S4、计算获得光栅的真实物理周期。
在一个实施例中，为了获得更准确的效果，在S1前还可以进行一些准备工作。例如，关闭任何与光栅垂直方向无关的干扰图案，确保只有周期a的线条与光栅平行。估算光栅周期dest（例如0.3mm ~ 0.5mm）（这个周期后文没有用到，这一步是否需要？就是d，后文均改为了）。相机记录与屏幕的“距离L”，无需记录姿态（R, t）。若相机能够输出三维坐标，则只取到屏幕平面的垂直距离即可。
在S1中，在底屏上以随机周期a显示线条，即在底屏显示周期为a的线条。其效果是让底屏居中显示一组平行条纹，条纹周期为a，条纹方向与光栅方向一致（同为竖线或同为横线），以免最后的摩尔条纹出现额外的“斜线扭曲”。确保条纹方向与光栅方向一致的方法为
在S2中，在不同距离dᵢ处，保持相机大致正对屏幕（无需严格，但要保证条纹在图像大部分区域可见），使用相机拍摄屏幕，获得图像i，记录每张照片对应的距离Lᵢ（单位mm）。
光栅本身具有周期b，当从一定距离d处观察或拍摄时，会出现莫尔条纹（Moiré Pattern）。在S3中，对每张拍摄图像i，检测莫尔条纹出现的“宏观条纹”（即肉眼可以观察到的）周期Mᵢ(dᵢ)（单位: 像素），检测方法为：
对拍摄图像i进行二维傅里叶变化，寻找峰值点对应的周期，即为摩尔条纹周期Mᵢ(Lᵢ)。
为了转化为实际物理周期Mp(Li)（Mi(mm)和Mi(di)有什么不同或关系？），需要了解相机在距离dᵢ处的成像缩放关系。可通过相机简单标定（仅参考焦距f和像素尺寸k）估算：
Mp(Li) ≈ Mᵢ(Li) × (k / f) × dᵢ
其中k / f表示单位距离处的像素与实际mm之间的换算系数，dᵢ则是相机到屏幕的距离。
莫尔条纹的“宏观周期”记为Mi(Li)，它与底屏周期ai和光栅周期b的关系满足：
1 / Mᵢ(Lᵢ) = |1 / ai - 1 / deff(Lᵢ)|                               （1）
其中，deff(Lᵢ)表示在距离Lᵢ观察时的有效光栅周期，因为光线经过光栅的折射/透视等因素，导致有效周期会随观测距离变化。
在S4中，求解上述方程，获得deff(Lᵢ)。此时d0怎么获得？没有获得
在一个实施例中，若对精度、准确性、稳定性等要求更高，可以取m个点，重复步骤S2-S3，构建方程组，拟合求解以获得光栅的真实物理周期、光栅与底屏的相对几何偏移。优选的，选择Lᵢ覆盖300mm ~ 1000mm的范围，每隔50 ~ 100mm采集一次。具体的步骤如下：
（1）我们做近似假设“光栅折射影响可视作固定偏移”，则可将deff(Lᵢ)简化成：
deff(Lᵢ) ≈ d
其中d为光栅的真实物理周期。
（2）将测得的m个Mᵢ(dᵢ)带入上式，可得到若干组方程：
1	/ Mᵢ(Lᵢ) = |1 / ai - 1 / deff(Lᵢ) |, i = 1, 2, …, m
（3）然后，拟合求解d。例如，可以使用最小二乘等方法，然后令𝛿 = 1 / Mᵢ(dᵢ) - |1/ai - 1/d|，希望∑[Fᵢ(b, d₀)]²最小，从而解得全局最优的b,、d₀以及折射修正量f₁。其中，最终光栅周期b，假设b_eff(dᵢ) = b（对薄光栅、近距离观察足够准确）（得到b就可以了吧，还要假设吗？），在实际渲染中，用初始偏移量d₀决定第0条光栅在底屏物理坐标中的起始位置；将b, d₀录入到实时渲染/视点计算模块中，就可以在算法中正确计算每条光栅中心位置x₍g₎ = n·b + d₀，以及渲染中的纹理映射分配，从而保证在计算光栅条带位置和显示映射时精度更高，提升立体观看效果。
在一个实施例中，在S4中，在距离d相对较近（数百mm）的情况下，若光栅厚度与折射率较小，可以视“光栅等效周期b_eff(d)”基本恒定为物理周期b。即如果光栅够薄，则b_eff(dᵢ) ≈ b。这个时候，1 / Mᵢ(dᵢ) = |1 / a - 1 / b|，Mi(di)不同吧，然后每个Mi（di）得到一个b，取平均值吗？而且后面d0怎么计算？
初始偏移量d₀主要影响莫尔条纹“相位”，对条纹周期无影响；在实际软件实现中，可先标定d，再通过测量“条纹相位偏移”来修正d₀。（这个怎么实现？本专利中涉及的话，需要介绍，或者是现有的方法？）
着重解释如何计算w'（由底屏周期a和光栅周期b叠加后形成的可见周期），以及如何利用该信息来求解光栅参数。（w'如何计算和应用？）
实施例1：
•	底屏周期a = 1 mm（即显示器每1 mm显示一条黑白相间线）。
•	光栅周期初估b_est = 0.4 mm。
•	在距离d = 500 mm拍摄到的莫尔条纹周期M = 8 mm（物理换算后）。
•	则1/M = 1/8 = 0.125，1/a = 1/1 = 1。
|1/a - 1/b_eff| = 0.125 ⇒ |1 - 1/b_eff| = 0.125 ⇒ 1/b_eff = 0.875或1.125。
得b_eff = 1.14 mm或0.88 mm（考虑哪个更合理需结合其他数据点）。
•	重复多个d的测量后，可以通过拟合得到确切b ≈ 0.4 mm（考虑了透视误差），以及相位对应的d₀。
本领域普通技术人员可以理解：以上各实施例仅用以说明本发明的技术方案，而非对其限制；尽管参照前述各实施例对本发明进行了详细的说明，本领域的普通技术人员应当理解：其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分或者全部技术特征进行等同替换；而这些修改或者替换，并不使相应技术方案的本质脱离本发明权利要求所限定的范围。

 
说   明   书   附   图



图1


图2


图3


图4


图5


 
说   明   书   摘   要

本发明公开了

 
摘   要   附   图



 
图3

